<!DOCTYPE html>
<html lang="en">

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Gogo</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="/assets/img/favicon.png" rel="icon">
  <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="qrcode.min.js"></script>
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">

      <div class="logo">
        <!-- <h1 class="text-light"><a href="index.html"><span></span></a></h1> -->
        <!-- Uncomment below if you prefer to use an image logo -->
        <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="shopindex.html">Home</a></li>
          <!-- <li><a class="nav-link scrollto" href="#about">About Us</a></li> -->
          <!-- <li><a class="nav-link scrollto" href="#services">Services</a></li> -->
          <li><a class="nav-link scrollto" href="shopindex.html">Shops</a></li>
          <!-- <li><a class="nav-link scrollto" href="#team">Team</a></li> -->
          <!-- <li class="dropdown"><a href="#"><span>Drop Down</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="#">Drop Down 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Drop Down</span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Deep Drop Down 1</a></li>
                  <li><a href="#">Deep Drop Down 2</a></li>
                  <li><a href="#">Deep Drop Down 3</a></li>
                  <li><a href="#">Deep Drop Down 4</a></li>
                  <li><a href="#">Deep Drop Down 5</a></li>
                </ul>
              </li>
              <li><a href="#">Drop Down 2</a></li>
              <li><a href="#">Drop Down 3</a></li>
              <li><a href="#">Drop Down 4</a></li>
            </ul>
          </li> -->
          <li><a href="rewards.html">Rewards</a></li>
          <li><a class="getstarted scrollto" onclick="logout()">Log Out</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs Section ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <span id='storeID'></span>
          <h1 id='companyName1'>Ah Hock Kopitiam</h1>
          <ol>

          </ol>
        </div>

      </div>
    </section><!-- Breadcrumbs Section -->

    <!-- ======= Portfolio Details Section ======= -->
    <section id="portfolio-details" class="portfolio-details">
      <div class="container">

        <div class="row gy-4">

          <div class="col-lg-8">
            <div class="portfolio-details-slider swiper-container">
              <div class="swiper-wrapper align-items-center">

                <div class="swiper-slide">
                  <img src="assets/img/portfolio/wetmarket.jpeg" alt="">
                </div>

                <div class="swiper-slide">
                  <img src="assets/img/portfolio/wetmkt2.jpeg" alt="">
                </div>



              </div>
              <div class="swiper-pagination"></div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="portfolio-info">
              <h3 id="companyName2">Ah Hock Kopitiam</h3>
              <ul>
                <li><strong>Location</strong>: Hougang Avenue 8, #01-222</li>

              </ul>
            </div>
            <div class="portfolio-description">
              <h2 id="companyName3">Ah Hock Kopitiam</h2>
              <p>
                Established in 1999, it is owned by uncle Hock as a way to make ends meet.
                To support a family of 5, he currently sells fishes below $20.
              </p>
              <p>
                Support small businesses like these by indicating your contribution amount below!
              </p>
              <div class="footer-newsletter">
                <div class="container">
                  <div class="row justify-content-center">
                    <div class="col-lg-6">

                        <div class="input-group mb-3">
                          <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">$</span>
                          </div>
                          <input type="number" class="form-control" value=10 id="amount" aria-describedby="basic-addon1">
                        </div>
                      

                      <button class="btn btn-light mt-auto" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                        onclick="contribute()">Contribute</button>

                    </div>

                  </div>
                  <br>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>
    </section><!-- End Portfolio Details Section -->
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">

    <div class="footer-newsletter">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-6">
            <h4>Want to nominate a small business?</h4>
            <p>Send in your entries here!</p>
            <form action="" method="post">
              <input type="email" name="email"><input type="submit" value="Submit">
            </form>
          </div>
        </div>
      </div>
    </div>


    </div>

    <div class="container py-4">
      <div class="copyright">
        &copy; Copyright <strong><span>Gogo</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/ninestars-free-bootstrap-3-theme-for-creative/ -->

      </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Scan the QR Code to transfer $<span
                id='contribution'></span> to <span id='companyName4'></span>!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body mx-auto">
            <div id="qrcode">
            </div>
          </div>
          <div class="modal-footer">
            <h6>You will receive <span id="coinsToReceive"></span> coins! Rejoice ðŸ˜ƒ</h6>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>  
  <script>
    // Get USERID 
    const userID = localStorage.getItem('userID')
    const userName = localStorage.getItem('userName')

    let userInputs = {
      "userID": userID
    }
    // Get company name
    // $(document).ready(function () {
    //   fetch("https://3iqkvxl23h.execute-api.us-east-1.amazonaws.com/dev", {
    //     method: 'get'
    //   }).then(response => response.json()).then(function (data) {
    //     const business = data.Items[0]
    //     var smallbizID = business.smallbizID
    //     document.getElementById("companyName1").innerHTML = business.companyName;
    //     document.getElementById("companyName2").innerHTML = business.companyName;
    //     document.getElementById("companyName3").innerHTML = business.companyName;
    //     document.getElementById("companyName4").innerHTML = business.companyName;
    //     document.getElementById("storeID").name = business.smallbizID;
    //   }).catch(function (error) {
    //     console.log(error)
    //   })
    // })

    function contribute() {
      // Get amount of contribution
      amount = document.getElementById("amount").value;
      document.getElementById("contribution").innerHTML = amount;
      document.getElementById("coinsToReceive").innerHTML = amount;

      //put URL for QR code here
      generateQRCode(userID, amount)
      //update contribution to business
      //update coins of contributor

    }

    function generateQRCode(ID, amount) {
      $('#qrcode').empty()
      let qrcode = new QRCode(document.getElementById('qrcode'))
      qrcode.makeCode(ID)

      $('#qrcode').click(function () {
        updateCoins(amount)
        addContribution(amount)

      })
    }

    async function updateCoins(amount) {

      let json_file = {
        "userID": userID,
        "amount": parseInt(amount),
        "addOrMinus": "add"
      }
      try {
        const response = await fetch('https://kkanrk8ag7.execute-api.us-east-1.amazonaws.com/dev', {
          method: 'PUT',
          headers: { "Content-Type": "application/json" }, body: JSON.stringify(json_file)
        });
        const result = await response.json()
        
        if (result) {
          alert("Thank You for Contributing!")

        } else {
          alert("Error unable to update coins. Please try again later")
        }

      } catch (err) {
        console.log(err)
      }
    }
    // insert donations
    async function addContribution(amount) {

      let date = new Date()
      let message = `${userName} has made a contribution of $${amount} on ${date}`

      let json_file = {
        "userID": userID,
        "smallBizID": "b1",
        "amount": parseInt(amount),
      }
      try {
        const response = await fetch('https://1t6d8gulag.execute-api.us-east-1.amazonaws.com/dev', {
          method: 'POST',
          headers: { "Content-Type": "application/json" }, body: JSON.stringify(json_file)
        });
        const result = await response.json()
        console.log(result)
        if (result) {
          
          sendSNS('96891917', message)
          // location.reload()
        } else {
          alert("Error unable to contribute. Please try again later")
        }

      } catch (err) {
        console.log(err)
      }
    }

    async function sendSNS(number, message) {

      let json_file = {
        "number": number,
        "message": message
      }

      try {
        const response = await fetch('https://r59md8dvhd.execute-api.us-east-1.amazonaws.com/dev', {
          method: 'POST',
          headers: { "Content-Type": "application/json" }, body: JSON.stringify(json_file)
        });
        const result = await response.json()
        
        if (result) {
          alert("You will receive a Confirmation Message soon!")
          location.reload()
        } else {
          alert("Error unable to contribute. Please try again later")
        }

      } catch (err) {
        console.log(err)
      }

    }

    function logout(){
            localStorage.clear()
            window.location.href = "./index.html"
    }
  </script>
</body>

</html>